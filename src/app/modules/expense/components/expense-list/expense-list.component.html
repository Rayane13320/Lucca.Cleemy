<div fxLayoutAlign="center" fxLayoutGap="1em" fxLayout="column">
  <p-table
    [value]="expenseQuery.expenseItems$ | async"
    [scrollable]="true"
    *ngIf="currencyQuery.active$ | async as currency"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id" i18n="@@expenseListHeaderId">
          Id <p-sortIcon field="id"></p-sortIcon>
        </th>
        <th pSortableColumn="purchasedOn" i18n="@@expenseListHeaderDate">
          Date <p-sortIcon field="purchasedOn"></p-sortIcon>
        </th>
        <th pSortableColumn="nature" i18n="@@expenseListHeaderNature">
          Nature <p-sortIcon field="nature"></p-sortIcon>
        </th>
        <th
          pSortableColumn="originalAmount.amount"
          i18n="@@expenseListHeaderAmount"
        >
          Amount <p-sortIcon field="originalAmount.amount"></p-sortIcon>
        </th>
        <th i18n="@@expenseListHeaderComment">Comment</th>
        <th pSortableColumn="comment" i18n="@@expenseListHeaderCreationDate">
          Creation Date <p-sortIcon field="comment"></p-sortIcon>
        </th>
        <th
          pSortableColumn="lastModifiedAt"
          i18n="@@expenseListHeaderModificationDate"
        >
          Last Modification Date
          <p-sortIcon field="lastModifiedAt"></p-sortIcon>
        </th>
        <th i18n="@@expenseListHeaderActions">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-expense>
      <tr>
        <td>{{ expense.id }}</td>
        <td>{{ expense.purchasedOn | date: "MM/dd/yyyy" }}</td>
        <td>{{ expense.nature }}</td>
        <td>
          {{
            expense.originalAmount.amount
              | currencyConvert
                : currencyQuery.getRate(
                    expense.originalAmount.currency,
                    currency.code
                  )
              | currency: currency.code
          }}
        </td>
        <td
          class="cell-comment"
          [pTooltip]="expense.comment"
          tooltipPosition="left"
        >
          {{ expense.comment }}
        </td>
        <td>{{ expense.createdAt | date: "MM/dd/yyyy HH:mm:ss" }}</td>
        <td>{{ expense.lastModifiedAt | date: "MM/dd/yyyy HH:mm:ss" }}</td>
        <td>
          <div fxLayoutAlign="space-evenly">
            <button
              pButton
              type="button"
              icon="pi pi-pencil"
              class="p-button-rounded"
              (click)="edit(expense.id)"
            ></button>
            <button
              pButton
              type="button"
              icon="pi pi-copy"
              class="p-button-rounded"
              (click)="duplicate(expense.id)"
            ></button>
            <button
              pButton
              type="button"
              icon="pi pi-times"
              class="p-button-rounded p-button-danger"
              confirm
              [message]="
                'Do you really want to delete the expense number ' +
                expense.id +
                ' ?'
              "
              (accept)="deleteExpense(expense.id)"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div fxLayout="column" fxLayoutAlign="center" fxLayoutGap="1em">
    <p-paginator
      [rows]="PAGE_ITEM_LIMIT"
      [totalRecords]="expenseQuery.expenseTotal$ | async"
      (onPageChange)="getExpenses($event.page + 1)"
    ></p-paginator>
    <div fxLayoutAlign="center">
      <button pButton (click)="create()" i18n="@@newExpenseButton">
        New expense
      </button>
    </div>
  </div>
</div>
<app-expense-dialog (expenseUpdate)="refreshPage()"></app-expense-dialog>
